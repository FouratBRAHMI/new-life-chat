<!--
  Generated template for the CommunityChatPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar color="primary">
    <ion-title *ngIf="subject">
      <ion-grid>
        <ion-row no-padding align-items-center justify-content-center>
          <img class="header-subject-img" [src]="'./assets/imgs/sujets/'+ subject.data.subject +'/'+ subject.data.subject +'_vert.png'"
          />
        </ion-row>
        <ion-row no-padding align-items-center justify-content-center>
          <span class="header-subject-name">{{ subject.data.name }}</span>
        </ion-row>
      </ion-grid>

    </ion-title>
  </ion-navbar>

</ion-header>

<ion-content class="messages">
  <ion-list no-padding *ngIf="communityData">
    <div *ngFor="let message of communityData.messages; let i = index">
      <ion-item no-lines>
        <ion-label>
          <p *ngIf="me && message.sender == me.uid">
            <span class="message-text right">{{message.content}}</span>
            <span class="message-time">{{message.date | date:"hh:mm a"}}</span>
          </p>
          <p *ngIf="me && message.sender != me.uid">
            <span class="message-text left" [ngClass]="{'pro':message.ref?.role=='pro'}" >{{message.content}}</span>
            <span class="message-time-left">
              <span *ngIf="message.ref">
                <span *ngIf="message.ref.role=='client'">{{message.ref.profile.pseudo}}</span>
                <span *ngIf="message.ref.role=='pro'">{{message.ref.profile.nom}}</span>
              </span>
              - {{message.date | date:"hh:mm a"}}
            </span>
          </p>
          <ion-avatar item-start *ngIf="me && message.sender != me.uid">
            <img *ngIf="message.ref && message.ref.role=='pro'" style="background-color: #91A4DB" src="./assets/imgs/lifechat-logo.png">
            <img *ngIf="message.ref && message.ref.role=='client'" [src]="'./assets/imgs/humeur/'+ message.ref.profile.humeur +'.png'">
          </ion-avatar>
        </ion-label>
        {{message.content}}
      </ion-item>
    </div>
  </ion-list>
</ion-content>

<ion-footer>
  <ion-toolbar no-padding>
    <ion-row>
      <ion-col no-padding>
        <ion-textarea type="text" [(ngModel)]="chatText" rows="1" [maxlength]="500" [placeholder]="'RÃ©digez votre message ...'"
          class="message-input" auto-size autocapitalize="off" block></ion-textarea>
      </ion-col>
      <ion-col col-auto no-padding text-right>
        <button ion-button (click)="sendMessage($event)" [disabled]="!chatText || (chatText && chatText.length > textMaxLength)"
          color="secondary" class="button-send" block>
          Envoi
        </button>
      </ion-col>
    </ion-row>
  </ion-toolbar>
</ion-footer>